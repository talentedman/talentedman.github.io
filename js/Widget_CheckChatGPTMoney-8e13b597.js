import{r as p,j as t,I as g,B as x,D as _,T as D,m as o}from"./vendor-59e032d3.js";async function b(a){if(!a){o.error("缺少API密钥");return}const r="https://api.openai.com/dashboard/billing/subscription",s={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Safari/537.36 Edg/112.0.1722.64",Authorization:`Bearer ${a}`,Accept:"*/*",Host:"api.openai.com",Connection:"keep-alive"};try{const e=await(await fetch(r,{headers:s})).json();if(e.error){o.error(e.error.message||JSON.stringify(e));return}const d=i=>`${i.getFullYear()}-${(i.getMonth()+1).toString().padStart(2,"0")}-${i.getDate().toString().padStart(2,"0")}`,h=d(new Date(new Date().getFullYear(),new Date().getMonth()-1,1)),m=d(new Date(new Date().getFullYear(),new Date().getMonth()+1,1)),l=await(await fetch(`https://api.openai.com/dashboard/billing/usage?start_date=${h}&end_date=${m}`,{headers:s})).json(),c=l.total_usage?(Math.round(l.total_usage)/100).toFixed(2):0,u=e.hard_limit_usd?(Math.round(e.hard_limit_usd*100)/100).toFixed(2):0;return e.apiKey=a,e.used=c,e.subscription=u,e.remaining=(Number(u)-Number(c)).toFixed(2),e.expirationDate=new Date(e.access_until*1e3).toLocaleString(),e.isBindCard=e.has_payment_method?"已绑卡":"未绑卡",e.system_hard_limit_usd=e.system_hard_limit_usd.toFixed(2),e}catch(n){o.error(n);return}}function w(){const[a,r]=p.useState(""),[s,n]=p.useState();return t.jsxs(t.Fragment,{children:[t.jsxs(g.Group,{compact:!0,children:[t.jsx(g,{addonBefore:"API秘钥",placeholder:"sk-xxx",style:{width:"60%"},value:a,onChange:e=>{r(e.target.value)}}),t.jsx(x,{type:"primary",onClick:async()=>{const e=await b(a);n(e?[e]:null),console.log(e)},children:"点击查询"})]}),t.jsx(_,{}),s?t.jsx(D,{columns:[{title:"有效期至",dataIndex:"apiKey"},{title:"有效期至",dataIndex:"expirationDate"},{title:"账户名称",dataIndex:"account_name"},{title:"是否绑卡",dataIndex:"isBindCard"},{title:"已消费额度",dataIndex:"used"},{title:"剩余额度",dataIndex:"remaining"},{title:"账户额度",dataIndex:"subscription"}],dataSource:s,bordered:!0,pagination:!1,size:"small",scroll:{y:700}}):null]})}export{w as default};
