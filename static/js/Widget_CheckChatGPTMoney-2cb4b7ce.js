import{r as p,j as e,I as x,T as _,B as f,D as b,g as y,m as g}from"./vendor-02d5f46d.js";async function D(a){if(!a){g.error("缺少API密钥");return}const u="https://api.openai.com/dashboard/billing/subscription",r={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Safari/537.36 Edg/112.0.1722.64",Authorization:`Bearer ${a}`,Accept:"*/*",Host:"api.openai.com",Connection:"keep-alive"};try{const t=await(await fetch(u,{headers:r})).json();if(t.error){g.error(t.error.message||JSON.stringify(t));return}const o=c=>`${c.getFullYear()}-${(c.getMonth()+1).toString().padStart(2,"0")}-${c.getDate().toString().padStart(2,"0")}`,s=o(new Date(new Date().getFullYear(),new Date().getMonth()-1,1)),d=o(new Date(new Date().getFullYear(),new Date().getMonth()+1,1)),n=await(await fetch(`https://api.openai.com/dashboard/billing/usage?start_date=${s}&end_date=${d}`,{headers:r})).json(),l=n.total_usage?(Math.round(n.total_usage)/100).toFixed(2):0,m=t.hard_limit_usd?(Math.round(t.hard_limit_usd*100)/100).toFixed(2):0;return t.apiKey=a,t.used=l,t.subscription=m,t.remaining=(Number(m)-Number(l)).toFixed(2),t.expirationDate=new Date(t.access_until*1e3).toLocaleString(),t.isBindCard=t.has_payment_method?"已绑卡":"未绑卡",t.system_hard_limit_usd=t.system_hard_limit_usd.toFixed(2),t}catch(i){g.error(i);return}}function I(){const[a,u]=p.useState(""),[r,i]=p.useState(),[t,o]=p.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(x.Group,{compact:!0,children:[e.jsx(_,{placeholder:"sk-xxx",style:{width:"60%"},value:a,onChange:s=>{u(s.target.value)},allowClear:!t,disabled:t}),e.jsx(f,{type:"primary",loading:t,onClick:async()=>{i(null),o(!0);const s=a.split(`
`);for(let d=0;d<s.length;d++){const h=s[d],n=await D(h);n&&i(l=>l?[n,...l]:[n])}o(!1)},children:"点击查询"})]}),e.jsx(b,{}),r?e.jsx(y,{columns:[{title:"有效期至",dataIndex:"apiKey"},{title:"有效期至",dataIndex:"expirationDate"},{title:"账户名称",dataIndex:"account_name"},{title:"是否绑卡",dataIndex:"isBindCard"},{title:"已消费额度",dataIndex:"used"},{title:"剩余额度",dataIndex:"remaining"},{title:"账户额度",dataIndex:"subscription"}],dataSource:r,bordered:!0,pagination:!1,size:"small",scroll:{y:700}}):null]})}export{I as default};
