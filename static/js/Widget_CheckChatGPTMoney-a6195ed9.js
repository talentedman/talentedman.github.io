import{r as h,j as s,T as y,B as x,g as f,m as u,D as _,h as b}from"./vendor-a9809486.js";async function w(a){if(!a){u.error("缺少API密钥");return}a=a.trim();const g="https://api.openai.com/dashboard/billing/subscription",t={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Safari/537.36 Edg/112.0.1722.64",Authorization:`Bearer ${a}`,Accept:"*/*",Host:"api.openai.com",Connection:"keep-alive"};try{const e=await(await fetch(g,{headers:t})).json();if(e.error){u.error(e.error.message||JSON.stringify(e));return}const l=p=>`${p.getFullYear()}-${(p.getMonth()+1).toString().padStart(2,"0")}-${p.getDate().toString().padStart(2,"0")}`,r=l(new Date(new Date().getFullYear(),new Date().getMonth()-1,1)),n=l(new Date(new Date().getFullYear(),new Date().getMonth()+1,1)),i=await(await fetch(`https://api.openai.com/dashboard/billing/usage?start_date=${r}&end_date=${n}`,{headers:t})).json(),d=i.total_usage?(Math.round(i.total_usage)/100).toFixed(2):0,m=e.hard_limit_usd?(Math.round(e.hard_limit_usd*100)/100).toFixed(2):0;return e.apiKey=a,e.used=d,e.subscription=m,e.remaining=(Number(m)-Number(d)).toFixed(2),e.expirationDate=new Date(e.access_until*1e3).toLocaleString(),e.isBindCard=e.has_payment_method?"已绑卡":"未绑卡",e.system_hard_limit_usd=e.system_hard_limit_usd.toFixed(2),e}catch(o){u.error(o);return}}function S(){const[a,g]=h.useState(""),[t,o]=h.useState(),[e,l]=h.useState(!1);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[s.jsx(y,{placeholder:"sk-xxx",style:{width:"60%",marginRight:20},value:a,onChange:r=>{g(r.target.value)},allowClear:!0,disabled:e}),s.jsx(x,{type:"primary",loading:e,onClick:async()=>{o(null),l(!0);const r=a.split(`
`);for(let n=0;n<r.length;n++){const c=r[n],i=await w(c);i&&o(d=>d?[i,...d]:[i])}l(!1)},children:"点击查询"}),s.jsx(x,{style:{marginLeft:20},type:"primary",id:"copy_btn",disabled:!t,onClick:()=>{new f("#copy_btn",{text:function(r){let n="";return t==null||t.forEach(c=>{n+=`${c.apiKey}
`}),n}}),u.success("复制成功")},children:"复制有效的key"})]}),s.jsx(_,{}),t?s.jsx(b,{columns:[{title:"有效期至",dataIndex:"apiKey"},{title:"有效期至",dataIndex:"expirationDate"},{title:"账户名称",dataIndex:"account_name"},{title:"是否绑卡",dataIndex:"isBindCard"},{title:"已消费额度",dataIndex:"used"},{title:"剩余额度",dataIndex:"remaining"},{title:"账户额度",dataIndex:"subscription"}],dataSource:t,bordered:!0,pagination:!1,size:"small",scroll:{y:700}}):null]})}export{S as default};
